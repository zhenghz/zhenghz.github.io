
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>跟着zabbix学监控--Linux(1) | 郑鸿志的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="郑鸿志">
    

    
    <meta name="description" content="操作系统的监控是性能监控的基础，Linux是目前的主流的服务器端操作系统。下面先从Zabbix对Linux 的监控入手。
Zabbix对Linux的监控项，从性能测试的角度看可分为  CPU、Memory（含Swap）、Network、Filesystems、Processes 几大类。
一、CPUCPU资源监控的KEY包含：



KEY
说明




system.cpu.intr
设备的中断">
<meta property="og:type" content="article">
<meta property="og:title" content="跟着zabbix学监控--Linux(1)">
<meta property="og:url" content="http://www.zhenghongzhi.cn/2017/01/13/zabbix_linux_1/index.html">
<meta property="og:site_name" content="郑鸿志的博客">
<meta property="og:description" content="操作系统的监控是性能监控的基础，Linux是目前的主流的服务器端操作系统。下面先从Zabbix对Linux 的监控入手。
Zabbix对Linux的监控项，从性能测试的角度看可分为  CPU、Memory（含Swap）、Network、Filesystems、Processes 几大类。
一、CPUCPU资源监控的KEY包含：



KEY
说明




system.cpu.intr
设备的中断">
<meta property="og:image" content="http://www.zhenghongzhi.cn/images/2017011301.png">
<meta property="og:image" content="http://www.zhenghongzhi.cn/images/2017011302.png">
<meta property="og:image" content="http://www.zhenghongzhi.cn/images/2017011303.png">
<meta property="og:image" content="http://www.zhenghongzhi.cn/images/2017011304.png">
<meta property="og:image" content="http://www.zhenghongzhi.cn/images/2017011305.png">
<meta property="og:updated_time" content="2017-01-18T07:30:23.898Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="跟着zabbix学监控--Linux(1)">
<meta name="twitter:description" content="操作系统的监控是性能监控的基础，Linux是目前的主流的服务器端操作系统。下面先从Zabbix对Linux 的监控入手。
Zabbix对Linux的监控项，从性能测试的角度看可分为  CPU、Memory（含Swap）、Network、Filesystems、Processes 几大类。
一、CPUCPU资源监控的KEY包含：



KEY
说明




system.cpu.intr
设备的中断">

    
    <link rel="alternative" href="/atom.xml" title="郑鸿志的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="郑鸿志的博客" title="郑鸿志的博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="郑鸿志的博客">郑鸿志的博客</a></h1>
				<h2 class="blog-motto">探寻数据背后的真相</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/01/13/zabbix_linux_1/" title="跟着zabbix学监控--Linux(1)" itemprop="url">跟着zabbix学监控--Linux(1)</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="郑鸿志" target="_blank" itemprop="author">郑鸿志</a>
		
  <p class="article-time">
    <time datetime="2017-01-12T16:00:00.000Z" itemprop="datePublished"> 发表于 2017-01-13</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			
		
		</div>
		
		<p>操作系统的监控是性能监控的基础，Linux是目前的主流的服务器端操作系统。下面先从Zabbix对Linux 的监控入手。</p>
<p>Zabbix对Linux的监控项，从性能测试的角度看可分为  CPU、Memory（含Swap）、Network、Filesystems、Processes 几大类。</p>
<p>一、CPU<br>CPU资源监控的KEY包含：</p>
<table>
<thead>
<tr>
<th style="text-align:left">KEY</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">system.cpu.intr</td>
<td style="text-align:center">设备的中断数。返回整数</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.load[<cpu>,<mode>]</mode></cpu></td>
<td style="text-align:center">CPU 负载。返回浮点数</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.num[<type>]</type></td>
<td style="text-align:center">CPU 数量，返回整数</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.switches</td>
<td style="text-align:center">上下文的数量进行切换。返回整数</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.util[<cpu>,<type>,<mode>]</mode></type></cpu></td>
<td style="text-align:center">CPU 使用率。返回浮点数</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<p>阅读源码（3.2.2版本）可以发现以上数据来自/proc 文件系统 和系统函数：</p>
<table>
<thead>
<tr>
<th style="text-align:left">KEY</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">system.cpu.intr</td>
<td style="text-align:center">设备的中断数,返回整数</td>
<td style="text-align:center">/proc/stat  intr 行</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.load[<cpu>,<mode>]</mode></cpu></td>
<td style="text-align:center">CPU 负载,返回浮点数</td>
<td style="text-align:center">系统函数 getloadavg</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.num[<type>]</type></td>
<td style="text-align:center">CPU 数量，返回整数</td>
<td style="text-align:center">/proc/cpuinfo 统计processor出现数量</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.switches</td>
<td style="text-align:center">上下文的数量进行切换，返回整数</td>
<td style="text-align:center">/proc/stat  ctxt 行</td>
</tr>
<tr>
<td style="text-align:left">system.cpu.util[<cpu>,<type>,<mode>]</mode></type></cpu></td>
<td style="text-align:center">CPU 使用率，返回浮点数</td>
<td style="text-align:center">/proc/stat  cpu开头的相关行</td>
</tr>
</tbody>
</table>
<p>磨刀不误砍柴工，想搞清楚每个KEY的含义，先得弄明白数据来源是啥会事儿。<br>/proc/stat 是最重要的CPU信息<br><img src="/images/2017011301.png" alt="cat /proc/stat"><br>以上图为例，包含：<br>1、前三行为CPU 花费在不同场景下的时间，包含总的时间和每个CPU内核的时间。比如主机有2个内核，会显示cpu、cpu0、cpu1三行，其中cpu行为下面两行的合并数据。数据列分为：user、nice、system、idle、iowait、irq、softirq、steal、guest。<br>需要特别说明的以上数据的时间单位为 0.01秒。<br>2、intr行，中断的信息，第1个为自系统启动以来发生的所有的中断的次数，后面每个数对应一个特定中断自系统启动以来所发生的次数。从/proc/interrupts 可以看到具体的数据。<br>存疑：<br>    1)、为什么 /proc/stat 比 /proc/interrupts 显示的特定中断多的多<br>    2)、 /proc/interrupts 中 irq 号非 数字的是啥<br>3、ctxt行，给出了自系统启动以来CPU发生的上下文交换的次数。<br>4、btimet行，从系统启动到现在为止的时间，单位为秒。<br>5、processest行， 自系统启动以来所创建的任务数目。<br>6、procs_runningt行，当前运行队列的任务数目。<br>7、procs_blockedt行，当前被阻塞的任务的数目（等待I/O完成）。<br>以上具体的含义，可以从linux源码（2.6.32.65版本）/fs/proc/stat.c 中略窥一二，以做印证。</p>
<p>/proc/cpuinfo中的信息较为简单，包含CPU每个核的基本物理参数，不做详述。</p>
<p>getloadavg() 函数，返回系统运行队列中的进程在不同时间段的平均数目。分为1、5、15分钟三种。（The getloadavg() function returns the number of processes in the system run queue averaged over various periods of time. Up to nelem samples are retrieved and assigned to successive elements of loadavg[]. The system imposes a maximum of 3 samples, representing averages over the last 1, 5, and 15 minutes, respectively.）</p>
<p>通过上面的基础信息，system.cpu.intr、system.cpu.switches 连个Key的值已经很明确。<br>system.cpu.load[<cpu>,<mode>]  数据来自系统函数：getloadavg。通过  cat /proc/loadavg 或者uptime命令，可以获取到1分钟、5分钟、15分钟的，这是全部CPU的数据，而Zabbix 在对这块数据的处理有所不同，返回的值默认是每CPU的平均值，具体可根据参数理解。<br>参数解释：</mode></cpu></p>
<p><cpu> 全部或按CPU平均，可选参数：不填、all，percpu，不填==all，all 表示按全部CPU取值，percpu为每CPU的平均值（all的值 除 CPU数量）</cpu></p>
<p><mode>可选参数：不填、avg1、avg5、avg15，不填==avg1，avg1 表示 1分钟，其他类推</mode></p>
<p>system.cpu.util[<cpu>,<type>,<mode>]涉及的数据最多，数据来自/proc/stat。前文已经说明/proc/stat 相关行记录的为百分之一毫秒数，并无我们通常看到的比例关系，Zabbix 为了反映这部分数据的百分比，做了特殊处理，在zabbix_agent 启动时，启动了一个 collector 线程（\zabbix_agent\stats.c，除去跟Linux 不相关的代码）：<br><img src="/images/2017011302.png" alt="\zabbix_agent\stats.c"><br>该线程每秒获取一次CPU状态，磁盘状态<br><img src="/images/2017011303.png" alt="\zabbix_agent\stats.c"><br>记录到 ZBX_COLLECTOR_DATA 结构的全局变量里<br><img src="/images/2017011304.png" alt="\zabbix_agent\stats.c "><br>在我们需要获取各CPU类型参数的时候，根据时间范围，获取两个时间点的差值，并计算百分比（\zabbix_agent\cpustat.c）。<br><img src="/images/2017011305.png" alt="\zabbix_agent\cpustat.c "><br>参数解释：</mode></type></cpu></p>
<p><cpu> cpu 编号，可选参数：不填、all，0-N，不填==all</cpu></p>
<p><type>可选参数：不填、user、nice、system、idle、iowait、interrupt、softirq、steal、guest、guest_nice，不填写==user</type></p>
<p><mode>可选参数：不填、avg1、avg5、avg15，不填写=avg1，avg1 表示 1分钟，其他类推</mode></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Zabbix/">Zabbix</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/Zabbix/">Zabbix</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.zhenghongzhi.cn/2017/01/13/zabbix_linux_1/" data-title="跟着zabbix学监控--Linux(1) | 郑鸿志的博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/01/14/zabbix_linux_2/" title="跟着zabbix学监控--Linux(2)">
  <strong>上一篇：</strong><br/>
  <span>
  跟着zabbix学监控--Linux(2)</span>
</a>
</div>


<div class="next">
<a href="/2017/01/13/study_zabbix/"  title="跟着zabbix学监控--前言">
 <strong>下一篇：</strong><br/> 
 <span>跟着zabbix学监控--前言
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>5</sup></a></li>
		  
		
		  
		
		  
			<li><a href="/categories/Performance/" title="Performance">Performance<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/TestAutomation/" title="TestAutomation">TestAutomation<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Zabbix/" title="Zabbix">Zabbix<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Zabbix/" title="Zabbix">Zabbix<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Performance/" title="Performance">Performance<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/JMS/" title="JMS">JMS<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Spring/" title="Spring">Spring<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Webdriver/" title="Webdriver">Webdriver<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/TestAutomation/" title="TestAutomation">TestAutomation<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>1</sup></a></li>
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://qitaos.github.io/" target="_blank" title="老道长的测试生活">老道长的测试生活</a>
            
          </li>
        
          <li>
            
            	<a href="http://jeffsui.github.io/pinghailinfeng_blog/" target="_blank" title="凭海临风的测试江湖">凭海临风的测试江湖</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m HongZhi.Zheng. <br/>
			This is my blog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="郑鸿志">郑鸿志</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
